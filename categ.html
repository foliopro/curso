<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Categorías - CanoMDigital</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: var(--fondo);
        transition: 0.3s;
    }

    /* =====================
       TEMAS
       ===================== */
    :root {
        --fondo: #f2f3f7;
        --card-bg: #fff;
        --text: #222;
        --desc: #666;
        --header-bg: #000;
        --header-text: #fff;
    }

    .dark {
        --fondo: #121212;
        --card-bg: #1f1f1f;
        --text: #f1f1f1;
        --desc: #ccc;
        --header-bg: #222;
        --header-text: #fff;
    }

    /* =====================
       HEADER
       ===================== */
    header {
        padding: 16px 20px;
        background: var(--header-bg);
        color: var(--header-text);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .menu-options {
        display: flex;
        gap: 20px;
    }

    .menu-btn {
        color: var(--header-text);
        cursor: pointer;
        font-size: 16px;
        transition: 0.2s;
    }

    .menu-btn:hover {
        opacity: 0.7;
    }

    /* =====================
       CARDS
       ===================== */
    #msg {
        text-align: center;
        padding: 25px;
        font-size: 20px;
        color: var(--text);
    }

    .container {
        padding: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
    }

    .card {
        background: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        cursor: pointer;
        overflow: hidden;
        transition: .2s ease;
        color: var(--text);
    }

    .card img {
        width: 100%;
        height: 160px;
        object-fit: cover;
    }

    .card-body {
        padding: 15px;
    }

    .card-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 6px;
        color: var(--text);
    }

    .card-desc {
        font-size: 14px;
        color: var(--desc);
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.25);
    }

    /* =====================
       MODAL
       ===================== */
    #modal-bg {
        position: fixed;
        display: none;
        justify-content: center;
        align-items: center;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.45);
        backdrop-filter: blur(5px);
        z-index: 10;
    }

    #modal {
        background: rgba(255,255,255,0.15);
        backdrop-filter: blur(12px);
        border-radius: 15px;
        width: 90%;
        max-width: 450px;
        padding: 25px;
        color: #fff;
        position: relative;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        animation: fadeIn 0.3s ease;
    }

    #modal h2 {
        margin-top: 0;
        margin-bottom: 10px;
    }

    #modal p {
        font-size: 16px;
    }

    .close-modal {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 22px;
        cursor: pointer;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
</style>

</head>
<body>

<header>
    <div style="font-size:20px;font-weight:bold;">Mis Cursos</div>

    <div class="menu-options">
        <div id="temaBtn" class="menu-btn">Tema Actual</div>
        <div onclick="logout()" class="menu-btn">Cerrar Sesión</div>
    </div>
</header>

<div id="msg">Cargando cursos...</div>
<div class="container" id="coursesContainer"></div>

<!-- MODAL -->
<div id="modal-bg">
    <div id="modal">
        <div class="close-modal" onclick="cerrarModal()">✖</div>
        <h2 id="modal-title"></h2>
        <p id="modal-detalle"></p>
    </div>
</div>

<script>
/* ===========================
   URLs de tus hojas reales
   =========================== */
const URL_USUARIO_CURSOS = 
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTW7_oAIdXB__TqA5-TIoiZ90qKfD109ihIW7PbEHCHZkZs5cMny-MGs3iukHz5OWFskFYBPIaHjA5J/pub?output=csv";

const URL_CURSOS_BDD =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRK5fDUiPrh1ihVYT-aC8GS9wfCcSuc0Auy2WpcuExPLkL36ZXasULcpKdTp_GYHXUrePujbjOFXrfR/pub?output=csv";

const URL_CURSOS_CONT =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQM-3mBbdkaK-jDv6DVdQd0VkehUZie71C5McD_djtCiN8GVSLA2ERqlQvmd17-o4ZZQB1Qrs1QXVGU/pub?output=csv";

/* ===========================
   Validar sesión
   =========================== */
const usuarioLog = localStorage.getItem("usuario");
if (!usuarioLog) window.location.href = "index.html";

/* CSV parser */
function parseCSV(text) {
    return text
        .split("\n")
        .map(r => r.replace(/\r/g, "").trim())
        .filter(r => r.length > 0)
        .map(r => r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
}

/* ===========================
   Tema Claro/Oscuro
   =========================== */
function aplicarTema() {
    let tema = localStorage.getItem("tema") || "light";
    if (tema === "dark") document.body.classList.add("dark");
    else document.body.classList.remove("dark");
}

document.getElementById("temaBtn").onclick = () => {
    let tema = localStorage.getItem("tema") || "light";
    tema = (tema === "light") ? "dark" : "light";
    localStorage.setItem("tema", tema);
    aplicarTema();
};

aplicarTema();

/* ===========================
   Logout
   =========================== */
function logout() {
    localStorage.clear();
    window.location.href = "index.html";
}

/* ===========================
   Modal
   =========================== */
function abrirModal(titulo, detalle) {
    document.getElementById("modal-title").textContent = titulo;
    document.getElementById("modal-detalle").textContent = detalle;
    document.getElementById("modal-bg").style.display = "flex";
}

function cerrarModal() {
    document.getElementById("modal-bg").style.display = "none";
}

document.getElementById("modal-bg").onclick = (e) => {
    if (e.target.id === "modal-bg") cerrarModal();
};

/* ===========================
   Cargar Cursos
   =========================== */
async function cargarCursos() {
    try {
        const resUC = await fetch(URL_USUARIO_CURSOS);
        const csvUC = await resUC.text();
        let rowsUC = parseCSV(csvUC);
        rowsUC.shift();

        let cursosAsign = rowsUC
            .filter(r => r[0].replace(/"/g,"").trim() === usuarioLog && r[2] === "A")
            .map(r => r[1]);

        if (cursosAsign.length === 0) {
            msg.textContent = "No tienes cursos asignados.";
            return;
        }

        const resC = await fetch(URL_CURSOS_BDD);
        const csvC = await resC.text();
        let rowsCB = parseCSV(csvC);
        rowsCB.shift();

        const resCont = await fetch(URL_CURSOS_CONT);
        const csvCont = await resCont.text();
        let rowsCont = parseCSV(csvCont);
        rowsCont.shift();

        let cont = document.getElementById("coursesContainer");
        cont.innerHTML = "";
        document.getElementById("msg").style.display = "none";

        cursosAsign.forEach(cod => {
            rowsCB.forEach(row => {
                if (row[0] === cod) {

                    let card = document.createElement("div");
                    card.className = "card";

                    card.innerHTML = `
                        <img src="${row[3]}">
                        <div class="card-body">
                            <div class="card-title">${row[1]}</div>
                            <div class="card-desc">${row[2]}</div>
                        </div>
                    `;

                    let tituloCurso = row[1];

                    /* Hover (PC) */
                    card.onmouseenter = () => {
                        if (window.innerWidth > 900) {
                            let detalle = buscarDetalle(cod, rowsCont);
                            abrirModal(tituloCurso, detalle);
                        }
                    };

                    /* Clic (Móvil/PC) */
                    card.onclick = () => {
                        let detalle = buscarDetalle(cod, rowsCont);
                        abrirModal(tituloCurso, detalle);
                    };

                    cont.appendChild(card);
                }
            });
        });

    } catch (e) {
        console.error(e);
        msg.textContent = "Error al cargar cursos.";
    }
}

function buscarDetalle(codCurso, contenidoRows) {
    let row = contenidoRows.find(r => r[0] === codCurso);
    return row ? (row[5] || "Sin detalle disponible") : "Sin información.";
}

cargarCursos();
</script>

</body>
</html>
