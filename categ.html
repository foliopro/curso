<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Categor√≠as - CanoMDigital</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f2f3f7;
    }

    header {
        padding: 20px;
        background: #000;
        color: white;
        text-align: center;
        font-size: 22px;
        letter-spacing: 1px;
    }

    #msg {
        text-align: center;
        padding: 25px;
        font-size: 20px;
        color: #555;
    }

    .container {
        padding: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
    }

    .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        cursor: pointer;
        overflow: hidden;
        transition: .2s ease;
    }

    .card img {
        width: 100%;
        height: 160px;
        object-fit: cover;
    }

    .card-body {
        padding: 15px;
    }

    .card-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 6px;
    }

    .card-desc {
        font-size: 14px;
        color: #555;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.18);
    }

</style>

</head>
<body>

<header>Mis Cursos</header>

<div id="msg">Cargando cursos...</div>
<div class="container" id="coursesContainer"></div>

<script>
const URL_USUARIO_CURSOS = 
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTW7_oAIdXB__TqA5-TIoiZ90qKfD109ihIW7PbEHCHZkZs5cMny-MGs3iukHz5OWFskFYBPIaHjA5J/pub?output=csv";

const URL_CURSOS_BDD =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRK5fDUiPrh1ihVYT-aC8GS9wfCcSuc0Auy2WpcuExPLkL36ZXasULcpKdTp_GYHXUrePujbjOFXrfR/pub?output=csv";

const usuarioLog = localStorage.getItem("usuario");
if (!usuarioLog) window.location.href = "index.html";

function parseCSV(text) {
    return text
        .split("\n")
        .map(r => r.replace(/\r/g, "").trim())
        .filter(r => r.length > 0)
        .map(r => r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
}

async function cargarCursos() {
    try {
        const resUC = await fetch(URL_USUARIO_CURSOS);
        const csvUC = await resUC.text();
        let rowsUC = parseCSV(csvUC);
        rowsUC.shift();

        let cursosAsign = rowsUC
            .filter(r => r[0].replace(/"/g,"").trim() === usuarioLog && r[2] === "A")
            .map(r => r[1]);

        if (cursosAsign.length === 0) {
            document.getElementById("msg").textContent = "No tienes cursos asignados.";
            return;
        }

        const resCB = await fetch(URL_CURSOS_BDD);
        const csvCB = await resCB.text();
        let rowsCB = parseCSV(csvCB);
        rowsCB.shift();

        let cont = document.getElementById("coursesContainer");
        cont.innerHTML = "";
        document.getElementById("msg").style.display = "none";

        cursosAsign.forEach(cod => {
            rowsCB.forEach(row => {
                if (row[0] === cod) {
                    let card = document.createElement("div");
                    card.className = "card";

                    card.innerHTML = `
                        <img src="${row[3]}">
                        <div class="card-body">
                            <div class="card-title">${row[1]}</div>
                            <div class="card-desc">${row[2]}</div>
                        </div>
                    `;

                    card.onclick = () => {
                        localStorage.setItem("curso_cod", row[0]);
                        localStorage.setItem("curso_titulo", row[1]);
                        localStorage.setItem("curso_desc", row[2]);
                        localStorage.setItem("curso_img", row[3]);

                        alert("Curso seleccionado: " + row[1]);
                    };

                    cont.appendChild(card);
                }
            });
        });

    } catch (e) {
        console.error(e);
        document.getElementById("msg").textContent = "Error al cargar cursos.";
    }
}

cargarCursos();
</script>

</body>
</html>
